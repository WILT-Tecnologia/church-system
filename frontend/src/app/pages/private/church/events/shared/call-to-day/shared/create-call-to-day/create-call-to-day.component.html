<form [formGroup]="callToDayForm" (ngSubmit)="onSubmit()" class="form-field-group">
  <app-column [columns]="2">
    <mat-form-field appearance="fill">
      <mat-label>Evento</mat-label>
      <input
        type="text"
        placeholder="Evento"
        matInput
        required
        [matAutocomplete]="autoEventType"
        [formControl]="searchEventControl"
        (focus)="filteredEvents()"
      />
      <mat-autocomplete #autoEventType="matAutocomplete" (optionSelected)="onSelectedEvents($event)">
        @for (event of filterEvents | async; track $index) {
          <mat-option [value]="event">
            {{ event.name }}
          </mat-option>
        } @empty {
          <mat-option disabled>Nenhum tipo de evento encontrado.</mat-option>
        }
      </mat-autocomplete>
      @if (callToDayForm.get('event_id')?.invalid && callToDayForm.get('event_id')?.touched) {
        <mat-error>{{ getErrorMessage('event_id') }}</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Tema</mat-label>
      <input matInput formControlName="theme" maxlength="255" />
      @if (callToDayForm.get('theme')?.invalid && callToDayForm.get('theme')?.touched) {
        <mat-error>{{ getErrorMessage('theme') }}</mat-error>
      }
    </mat-form-field>
  </app-column>

  <!-- Campos de data e hora -->
  <app-column [columns]="2">
    <app-column [columns]="2">
      <mat-form-field>
        <mat-label>Data inicial</mat-label>
        <input
          matInput
          type="text"
          name="start_date"
          [matDatepicker]="start_date"
          placeholder="dd/mm/aaaa"
          formControlName="start_date"
          [min]="minDate"
          required
        />
        <mat-datepicker-toggle matIconSuffix [for]="start_date"></mat-datepicker-toggle>
        <mat-datepicker #start_date>
          <mat-datepicker-actions>
            @if (callToDayForm.get('start_date')?.value) {
              <button
                matTooltip="Limpar a data"
                mat-flat-button
                matSuffix
                matDatepickerToggleIcon
                (click)="clearDate('start_date')"
                type="button"
                color="warn"
              >
                <mat-icon>close</mat-icon>
                Limpar
              </button>
            } @else {
              <button type="button" mat-stroked-button matDatepickerCancel>Cancelar</button>
              <button type="button" mat-flat-button matDatepickerApply>Concluir</button>
            }
          </mat-datepicker-actions>
        </mat-datepicker>
        @if (callToDayForm.get('start_date')?.invalid && callToDayForm.get('start_date')?.touched) {
          <mat-error>{{ getErrorMessage('start_date') }} </mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Hora inicial</mat-label>
        <input matInput type="time" formControlName="start_time" required placeholder="hh:mm" />
        @if (callToDayForm.get('start_time')?.invalid && callToDayForm.get('start_time')?.touched) {
          <mat-error>{{ getErrorMessage('start_time') }}</mat-error>
        }
      </mat-form-field>
    </app-column>

    <app-column [columns]="2">
      <mat-form-field>
        <mat-label>Data final</mat-label>
        <input
          matInput
          name="end_date"
          placeholder="dd/mm/aaaa"
          formControlName="end_date"
          [matDatepicker]="end_date"
          [min]="minDate"
          required
          readonly
        />
        <mat-datepicker-toggle matIconSuffix [for]="end_date"></mat-datepicker-toggle>
        <mat-datepicker #end_date>
          <mat-datepicker-actions>
            @if (callToDayForm.get('end_date')?.value) {
              <button
                matTooltip="Limpar a data"
                mat-flat-button
                matSuffix
                matDatepickerToggleIcon
                (click)="clearDate('end_date')"
                type="button"
                color="warn"
              >
                <mat-icon>close</mat-icon>
                Limpar
              </button>
            } @else {
              <button type="button" mat-stroked-button matDatepickerCancel>Cancelar</button>
              <button type="button" mat-flat-button matDatepickerApply>Concluir</button>
            }
          </mat-datepicker-actions>
        </mat-datepicker>
        @if (callToDayForm.get('end_date')?.invalid && callToDayForm.get('end_date')?.touched) {
          <mat-error>{{ getErrorMessage('end_date') }} </mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Hora final</mat-label>
        <input matInput type="time" formControlName="end_time" required placeholder="hh:mm" />
        @if (callToDayForm.get('end_time')?.invalid && callToDayForm.get('end_time')?.touched) {
          <mat-error>{{ getErrorMessage('end_time') }}</mat-error>
        }
      </mat-form-field>
    </app-column>
  </app-column>

  <app-column [columns]="1">
    <mat-form-field appearance="fill">
      <mat-label>Local</mat-label>
      <input matInput formControlName="location" maxlength="255" />
      @if (callToDayForm.get('location')?.invalid && callToDayForm.get('location')?.touched) {
        <mat-error>{{ getErrorMessage('location') }}</mat-error>
      }
    </mat-form-field>
  </app-column>

  <app-actions>
    <button mat-stroked-button type="button" color="warn" (click)="onCancel()">Cancelar</button>
    <button mat-flat-button type="submit" color="primary" [disabled]="callToDayForm.invalid">
      {{ isEditMode() ? 'Atualizar' : 'Cadastrar' }}
    </button>
  </app-actions>
</form>
